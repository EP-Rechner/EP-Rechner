import Link from "next/link";
import { useEffect, useState } from "react";

export default function Confirmed() {
  const [status, setStatus] = useState("loading");
  const [message, setMessage] = useState("");

  useEffect(() => {
    // Supabase hängt bei Fehlern häufig ?error_code=...&error_description=...
    const params = new URLSearchParams(window.location.search);
    const errorCode = params.get("error_code") || params.get("error");
    const errorDesc =
      params.get("error_description") || params.get("message") || "";

    if (errorCode) {
      setStatus("error");
      setMessage(decodeURIComponent(errorDesc));
    } else {
      // Wenn kein Fehler übergeben wurde, war die Verifizierung erfolgreich.
      setStatus("success");
    }
  }, []);

  if (status === "loading") {
    return (
      <div style={{ maxWidth: 560, margin: "64px auto", textAlign: "center" }}>
        <h1>Bitte warten…</h1>
        <p>Wir prüfen deine Bestätigung.</p>
      </div>
    );
  }

  if (status === "error") {
    return (
      <div style={{ maxWidth: 560, margin: "64px auto", textAlign: "center" }}>
        <h1>❌ Bestätigung fehlgeschlagen</h1>
        <p style={{ color: "#b91c1c" }}>
          {message || "Der Link ist ungültig oder abgelaufen."}
        </p>
        <p>
          Du kannst dir jederzeit einen neuen Bestätigungs-Link zusenden lassen.
        </p>
        <Link href="/login" style={{ textDecoration: "underline" }}>
          Zurück zum Login
        </Link>
      </div>
    );
  }

  return (
    <div style={{ maxWidth: 560, margin: "64px auto", textAlign: "center" }}>
      <h1>✅ E-Mail erfolgreich bestätigt!</h1>
      <p>Du kannst dich jetzt anmelden und Equine-Rechner nutzen.</p>
      <Link href="/login" style={{ textDecoration: "underline" }}>
        Weiter zum Login
      </Link>
    </div>
  );
}
